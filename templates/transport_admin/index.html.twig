{% extends 'basebackoffice.html.twig' %}

{% block title %}transport Management{% endblock %}

{% block content %}
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0">transport Management</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
                    <li class="breadcrumb-item active">transports</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<section class="content">
    <div class="container-fluid">
        <!-- transport Statistics Cards -->
        <div class="row">
            <div class="col-lg-3 col-6">
                <div class="small-box bg-info">
                    <div class="inner">
                        <h3>{{ transports|length }}</h3>
                        <p>Total transports</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-user-tie"></i>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3 col-6">
                <div class="small-box bg-success">
                    <div class="inner">
                        <h3>{{ transports|filter(d => d.isActive ?? true)|length }}</h3>
                        <p>Active transports</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3 col-6">
                <div class="small-box bg-warning">
                    <div class="inner">
                        <h3>{{ transports|filter(d => not (d.isActive ?? true))|length }}</h3>
                        <p>Inactive transports</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-pause-circle"></i>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3 col-6">
                <div class="small-box bg-danger">
                    <div class="inner">
                        <h3>0</h3>
                        <p>Warnings</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- transport List Card -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">All transports</h3>
                        <div class="card-tools">
                            <form method="get" action="{{ path('app_transport_admin_index') }}" class="form-inline">
                            <div class="input-group input-group-sm" style="width: 250px;">
                                <input type="text" name="search" class="form-control float-right" placeholder="Search transports..." value="{{ app.request.query.get('search') }}" >
                                <div class="input-group-append">
                                    <button type="submit" class="btn btn-default">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                                <div class="ml-2 d-inline-block">
                                <a href="{{ path('app_transport_admin_new') }}" class="btn btn-primary btn-sm">
                                    <i class="fas fa-plus"></i> Add transport
                                </a>
                            </div>
                            </div>
                            </form>
                        </div>
                    </div>
                    
                    <div class="card-body table-responsive p-0">
                        <table class="table table-hover text-nowrap">
                            <thead>
                                <tr>
                                    <th style="width: 60px">ID</th>
                                    <th>transport Info</th>
                                    <th>Vehicle Details</th>
                                    <th>License Plate</th>
                                    <th>Max Luggage</th>
                                    <th>Status</th>
                                    <th class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% for transport in pagination %}
                                <tr>
                                    <td>{{ transport.id }}</td>
                                    <td>
                                        <div class="user-block">
                                            <img class="img-circle" src="{{ asset('backoffice/dist/img/avatar5.png') }}" alt="transport">
                                            <span class="username">
                                                <a href="#">{{ transport.user.fullName ?? 'transport #' ~ transport.id }}</a>
                                            </span>
                                            <span class="description">
                                                <i class="fas fa-phone text-primary"></i> {{ transport.user.phoneNumber ?? 'N/A' }}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary">{{ transport.carModel }}</span>
                                        <span class="badge" style="background-color: {{ transport.carColor|lower }}; color: {{ transport.carColor|lower in ['white', 'yellow', 'beige'] ? '#000' : '#fff' }};">
                                            {{ transport.carColor }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-dark">{{ transport.licensePlate }}</span>
                                    </td>
                                    <td>
                                        <div class="progress progress-sm">
                                            {% set maxLuggagePercentage = (transport.maxLuggage / 5) * 100 %}
                                            <div class="progress-bar bg-info" style="width: {{ maxLuggagePercentage }}%"></div>
                                        </div>
                                        <small>{{ transport.maxLuggage }} pieces</small>
                                    </td>
                                    <td>
                                        {% if transport.status is defined %}
                                            {% if transport.status == 'Active' %}
                                                <span class="badge bg-success">Active</span>
                                            {% elseif transport.status == 'Inactive' %}
                                                <span class="badge bg-danger">Inactive</span>
                                            {% endif %}
                                        {% else %}
                                            <span class="badge bg-danger">Error</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        <div class="btn-group">
                                            <a href="{{ path('app_transport_admin_show', {'id': transport.id}) }}" class="btn btn-info btn-sm" title="View details">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a href="{{ path('app_transport_admin_edit', {'id': transport.id}) }}" class="btn btn-warning btn-sm" title="Edit transport">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <button type="button" class="btn btn-danger btn-sm" title="Delete" data-toggle="modal" data-target="#delete-modal-{{ transport.id }}"
                                                {% if (transport.isActive is defined and not transport.isActive) %}disabled{% endif %}>
                                                <i class="fas fa-ban"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="7" class="text-center py-5">
                                        <div class="empty-state">
                                            <i class="fas fa-user-slash fa-3x text-muted"></i>
                                            <p class="mt-3">No transports have been added to the system yet.</p>
                                            <a href="{{ path('app_transport_admin_new') }}" class="btn btn-primary">
                                                <i class="fas fa-plus"></i> Add First transport
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    
                    <div class="card-footer clearfix">
    <ul class="pagination pagination-sm m-0 float-right">
        {% if pagination.page > 1 %}
            <li class="page-item">
                <a class="page-link" href="{{ path('app_transport_admin_index', app.request.query.all|merge({'page': pagination.page-1})) }}">«</a>
            </li>
        {% else %}
            <li class="page-item disabled">
                <span class="page-link">«</span>
            </li>
        {% endif %}
        
        {% for i in 1..pagination.pageCount %}
            <li class="page-item {% if i == pagination.page %}active{% endif %}">
                <a class="page-link" href="{{ path('app_transport_admin_index', app.request.query.all|merge({'page': i})) }}">{{ i }}</a>
            </li>
        {% endfor %}
        
        {% if pagination.page < pagination.pageCount %}
            <li class="page-item">
                <a class="page-link" href="{{ path('app_transport_admin_index', app.request.query.all|merge({'page': pagination.page+1})) }}">»</a>
            </li>
        {% else %}
            <li class="page-item disabled">
                <span class="page-link">»</span>
            </li>
        {% endif %}
    </ul>
</div>
                </div>
            </div>
        </div>

        <!-- transport Statistics Graphs -->
        <div class="row">
            <div class="col-md-6">
    <h5 class="card-header bg-primary text-white">Car Color Distribution</h5>
    <div class="card-body">
        {{ render_chart(chart_transport_statistics) }}
    </div>
</div>

<div class="col-md-6">
    <h5 class="card-header bg-info text-white">Top Vehicles by Max Luggage</h5>
    <div class="card-body">
        {{ render_chart(chart_top_vehicles) }}
    </div>
</div>

        </div>

    </div>
</section>

<!-- Delete Modals -->
{% for transport in transports %}
    <div class="modal fade" id="delete-modal-{{ transport.id }}">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger">
                    <h4 class="modal-title">Confirm transport Deletion</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this transport record?</p>
                    <p class="text-danger"><small>This action cannot be undone.</small></p>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <form method="post" action="{{ path('app_transport_admin_delete', {'id': transport.id}) }}" style="display:inline-block;">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ transport.id) }}">
                        <button type="submit" class="btn btn-danger">
                            Delete
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endfor %}
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
  $(function () {
    $('[data-toggle="tooltip"]').tooltip();
    $('input[name="table_search"]').on('keyup', function() {
      let value = $(this).val().toLowerCase();
      $('tbody tr').filter(function() {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
    });
  });
</script>
{% endblock %}
